# Phase 4 - Sentinel Alert Examples

Complete examples of alerts generated by Sentinel for different attack types.

## Alert Payload Structure

All alerts follow this JSON structure:

```json
{
  "timestamp": "ISO8601_UTC",
  "attack_type": "attack_category",
  "source_ip": "attacker_ip",
  "evidence": "log_line_or_description",
  "severity": "critical|high|medium",
  "pod_name": "kubernetes_pod_name",
  "decoy_urls": ["url1", "url2", "url3"]
}
```

## Example 1: SQL Injection Alert

**Attack**: SQLi via UNION SELECT

**Request**:
```
GET /api/products?id=1' UNION SELECT username,password FROM users--
```

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:30:15Z",
  "attack_type": "sql_injection",
  "source_ip": "192.168.1.100",
  "evidence": "{\"timestamp\":\"2026-02-04T16:30:15Z\",\"service\":\"frontend-api\",\"method\":\"GET\",\"path\":\"/api/products?id=1' UNION SELECT username,password FROM users--\",\"source_ip\":\"192.168.1.100\"}",
  "severity": "critical",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 2: SQL Injection - OR 1=1

**Attack**: SQLi using OR 1=1 bypass

**Request**:
```
POST /api/login
{"username": "admin' OR '1'='1", "password": "anything"}
```

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:31:00Z",
  "attack_type": "sql_injection",
  "source_ip": "10.0.0.50",
  "evidence": "{\"timestamp\":\"2026-02-04T16:31:00Z\",\"service\":\"frontend-api\",\"method\":\"POST\",\"path\":\"/api/login\",\"source_ip\":\"10.0.0.50\"}",
  "severity": "critical",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 3: Path Traversal Alert

**Attack**: Directory traversal to access /etc/passwd

**Request**:
```
GET /api/file?path=../../../../etc/passwd
```

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:32:00Z",
  "attack_type": "path_traversal",
  "source_ip": "172.16.0.10",
  "evidence": "{\"timestamp\":\"2026-02-04T16:32:00Z\",\"service\":\"frontend-api\",\"method\":\"GET\",\"path\":\"/api/file?path=../../../../etc/passwd\",\"source_ip\":\"172.16.0.10\"}",
  "severity": "high",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 4: Path Traversal - URL Encoded

**Attack**: URL-encoded path traversal

**Request**:
```
GET /api/download?file=%2e%2e%2f%2e%2e%2fetc%2fpasswd
```

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:33:00Z",
  "attack_type": "path_traversal",
  "source_ip": "203.0.113.45",
  "evidence": "{\"timestamp\":\"2026-02-04T16:33:00Z\",\"service\":\"frontend-api\",\"method\":\"GET\",\"path\":\"/api/download?file=%2e%2e%2f%2e%2e%2fetc%2fpasswd\",\"source_ip\":\"203.0.113.45\"}",
  "severity": "high",
  "pod_name": "frontend-api-7d8f9c6b5-xyz78",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 5: Rate Limit Exceeded

**Attack**: Rapid automated requests (DDoS attempt)

**Scenario**: 60 requests in 1 minute from single IP

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:34:00Z",
  "attack_type": "rate_limit_exceeded",
  "source_ip": "198.51.100.25",
  "evidence": "Request rate: 60 requests in 1m0s",
  "severity": "medium",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 6: Auth Failure Brute Force

**Attack**: Multiple failed login attempts

**Scenario**: 5 failed login attempts in 1 minute

**Alert Payload**:
```json
{
  "timestamp": "2026-02-04T16:35:00Z",
  "attack_type": "auth_failure_brute_force",
  "source_ip": "93.184.216.34",
  "evidence": "Multiple auth failures: 5 in 1m0s",
  "severity": "high",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

## Example 7: Multiple Attack Types (Same IP)

**Scenario**: Attacker tries multiple attack vectors

**First Alert** (SQLi):
```json
{
  "timestamp": "2026-02-04T16:36:00Z",
  "attack_type": "sql_injection",
  "source_ip": "192.168.1.100",
  "evidence": "...",
  "severity": "critical",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [...]
}
```

**No subsequent alerts for 5 minutes** (cooldown period)

Even if same IP attempts:
- Path traversal at 16:37:00 → No alert (cooldown)
- Rate limit at 16:38:00 → No alert (cooldown)
- Another SQLi at 16:39:00 → No alert (cooldown)

**Second Alert** (after cooldown expires):
```json
{
  "timestamp": "2026-02-04T16:41:01Z",
  "attack_type": "path_traversal",
  "source_ip": "192.168.1.100",
  "evidence": "...",
  "severity": "high",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [...]
}
```

## Example 8: Controller Response

When Sentinel sends alert to Controller:

**Sentinel Request**:
```bash
POST http://controller:8080/api/alerts
Content-Type: application/json

{
  "timestamp": "2026-02-04T16:30:00Z",
  "attack_type": "sql_injection",
  "source_ip": "192.168.1.100",
  "evidence": "...",
  "severity": "critical",
  "pod_name": "frontend-api-7d8f9c6b5-abc12",
  "decoy_urls": [
    "http://decoy-frontend-1:8080",
    "http://decoy-frontend-2:8080",
    "http://decoy-frontend-3:8080"
  ]
}
```

**Controller Response** (expected):
```json
{
  "success": true,
  "message": "Alert processed and attacker redirected",
  "source_ip": "192.168.1.100",
  "action_taken": "blocked"
}
```

## Testing Alerts Manually

### Test 1: SQLi Detection

```bash
# Deploy services
kubectl apply -f deploy/k8s/frontend-api.yaml
kubectl apply -f deploy/k8s/sentinel.yaml

# Wait for pods to be ready
kubectl wait --for=condition=ready pod -l app=sentinel
kubectl wait --for=condition=ready pod -l app=frontend-api

# Send SQLi request
NODE_IP=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type=="InternalIP")].address}')
curl "http://$NODE_IP:30000/api/products?id=1'%20UNION%20SELECT%20*%20FROM%20users--"

# Check sentinel logs
kubectl logs -l app=sentinel | tail -20
```

**Expected Log**:
```
[ALERT] Sending: {"timestamp":"2026-02-04T16:30:00Z","attack_type":"sql_injection",...}
[ALERT] Sent successfully to controller
```

### Test 2: Rate Limiting

```bash
# Send 60 requests rapidly
for i in {1..60}; do
  curl -s -H "X-Forwarded-For: 192.168.1.100" \
    "http://$NODE_IP:30000/api/products" > /dev/null &
done
wait

# Check for rate limit alert
kubectl logs -l app=sentinel | grep rate_limit_exceeded
```

### Test 3: Path Traversal

```bash
# Send path traversal attack
curl "http://$NODE_IP:30000/api/file?path=..%2f..%2fetc%2fpasswd"

# Check sentinel logs
kubectl logs -l app=sentinel | grep path_traversal
```

### Test 4: Auth Failures

```bash
# Send 5 failed login attempts
for i in {1..5}; do
  curl -X POST "http://$NODE_IP:30000/api/login" \
    -H "Content-Type: application/json" \
    -H "X-Forwarded-For: 10.0.0.50" \
    -d '{"username":"admin","password":"wrong"}'
  sleep 10
done

# Check for auth failure alert
kubectl logs -l app=sentinel | grep auth_failure
```

## Alert Severity Levels

| Severity | Attack Types | Response Priority |
|----------|--------------|-------------------|
| **Critical** | SQL Injection | Immediate blocking |
| **High** | Path Traversal, Auth Brute Force | High priority blocking |
| **Medium** | Rate Limit Exceeded | Standard blocking |

## Sentinel Log Format

Sentinel logs all actions in JSON:

**Detection Log**:
```json
{
  "timestamp": "2026-02-04T16:30:00Z",
  "level": "INFO",
  "action": "detect",
  "attack_type": "sql_injection",
  "source_ip": "192.168.1.100",
  "pod_name": "frontend-api-7d8f9c6b5-abc12"
}
```

**Alert Sent Log**:
```json
{
  "timestamp": "2026-02-04T16:30:01Z",
  "level": "INFO",
  "action": "alert_sent",
  "source_ip": "192.168.1.100",
  "controller_response": "200 OK"
}
```

**Cooldown Skip Log**:
```json
{
  "timestamp": "2026-02-04T16:31:00Z",
  "level": "INFO",
  "action": "cooldown_skip",
  "source_ip": "192.168.1.100",
  "reason": "Alert sent 1m ago, cooldown period: 5m"
}
```

---

**All examples use placeholder decoy URLs. In production, Controller will provide actual decoy service URLs.**
